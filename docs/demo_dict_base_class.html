---

title: Using `dict` as base class


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/examples/demo_dict_base_class.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/examples/demo_dict_base_class.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">creator</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">algorithms</span>
<span class="kn">from</span> <span class="nn">eptune.parameter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">toolbox</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Toolbox</span><span class="p">()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">LogFloatParameter</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1000</span><span class="p">],</span><span class="s1">&#39;C&#39;</span><span class="p">),</span>
          <span class="n">CategoricalParameter</span><span class="p">([</span><span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">],</span><span class="s2">&quot;kernel&quot;</span><span class="p">),</span>
          <span class="n">LogFloatParameter</span><span class="p">([</span><span class="mf">1e-6</span><span class="p">,</span><span class="mf">1e6</span><span class="p">],</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
         <span class="p">]</span>
<span class="k">def</span> <span class="nf">initParams</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">({</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">params</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">estimator</span><span class="p">):</span>
    <span class="n">estimator</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
    <span class="n">estimator</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">estimator</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)]</span>

<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Fitness</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,))</span>
<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Parameters&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="n">creator</span><span class="o">.</span><span class="n">Metric</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">,</span> <span class="n">initParams</span><span class="p">,</span> <span class="n">creator</span><span class="o">.</span><span class="n">Parameters</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initRepeat</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">individual</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;evaluate&#39;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">evaluate</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="n">svc</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">eptune.utils</span> <span class="kn">import</span> <span class="n">ConcurrentMap</span>
<span class="n">pmap</span> <span class="o">=</span> <span class="n">ConcurrentMap</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="n">pmap</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>

<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">selTournament</span><span class="p">,</span> <span class="n">tournsize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">eptune.crossover</span> <span class="kn">import</span> <span class="n">cxDictUniform</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mate&quot;</span><span class="p">,</span> <span class="n">cxDictUniform</span><span class="p">,</span> <span class="n">indpb</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">eptune.mutation</span> <span class="kn">import</span> <span class="n">mutDictRand</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mutate&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">mutDictRand</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">indpb</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Statistics</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ind</span><span class="p">:</span> <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">eaSimple</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">toolbox</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> run()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>gen	nevals	avg         	std         	min         	max         
0  	10    	[0.15833333]	[0.25833333]	[0.07222222]	[0.93333333]
1  	10    	[0.42472222]	[0.43235725]	[0.07222222]	[0.98888889]
2  	10    	[0.76833333]	[0.34971593]	[0.07222222]	[0.98888889]
3  	8     	[0.8775]    	[0.27052318]	[0.07222222]	[0.98888889]
4  	9     	[0.80555556]	[0.36666667]	[0.07222222]	[0.98888889]
5  	10    	[0.98888889]	[0.]        	[0.98888889]	[0.98888889]
6  	7     	[0.80555556]	[0.36666667]	[0.07222222]	[0.98888889]
7  	7     	[0.80555556]	[0.36666667]	[0.07222222]	[0.98888889]
8  	10    	[0.89722222]	[0.275]     	[0.07222222]	[0.98888889]
9  	9     	[0.62222222]	[0.44907312]	[0.07222222]	[0.98888889]
10 	10    	[0.95638889]	[0.0975]    	[0.66388889]	[0.98888889]
CPU times: user 79.7 ms, sys: 7.16 ms, total: 86.9 ms
Wall time: 4.48 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([{&#39;C&#39;: 0.35813091550107573, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 0.35813091550107573, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 683811.3595507575},
  {&#39;C&#39;: 0.3713400181134504, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 0.17824295463588005, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 5.186037545349469,
   &#39;kernel&#39;: &#39;sigmoid&#39;,
   &#39;gamma&#39;: 0.0007503440412925995},
  {&#39;C&#39;: 0.3713400181134504, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 0.17824295463588005, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 0.10261439146097412, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 2.2814616698193086},
  {&#39;C&#39;: 0.35813091550107573, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848},
  {&#39;C&#39;: 0.3713400181134504, &#39;kernel&#39;: &#39;poly&#39;, &#39;gamma&#39;: 5574.22062214848}],
 [{&#39;gen&#39;: 0,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.15833333]),
   &#39;std&#39;: array([0.25833333]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.93333333])},
  {&#39;gen&#39;: 1,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.42472222]),
   &#39;std&#39;: array([0.43235725]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 2,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.76833333]),
   &#39;std&#39;: array([0.34971593]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 3,
   &#39;nevals&#39;: 8,
   &#39;avg&#39;: array([0.8775]),
   &#39;std&#39;: array([0.27052318]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 4,
   &#39;nevals&#39;: 9,
   &#39;avg&#39;: array([0.80555556]),
   &#39;std&#39;: array([0.36666667]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 5,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.98888889]),
   &#39;std&#39;: array([0.]),
   &#39;min&#39;: array([0.98888889]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 6,
   &#39;nevals&#39;: 7,
   &#39;avg&#39;: array([0.80555556]),
   &#39;std&#39;: array([0.36666667]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 7,
   &#39;nevals&#39;: 7,
   &#39;avg&#39;: array([0.80555556]),
   &#39;std&#39;: array([0.36666667]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 8,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.89722222]),
   &#39;std&#39;: array([0.275]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 9,
   &#39;nevals&#39;: 9,
   &#39;avg&#39;: array([0.62222222]),
   &#39;std&#39;: array([0.44907312]),
   &#39;min&#39;: array([0.07222222]),
   &#39;max&#39;: array([0.98888889])},
  {&#39;gen&#39;: 10,
   &#39;nevals&#39;: 10,
   &#39;avg&#39;: array([0.95638889]),
   &#39;std&#39;: array([0.0975]),
   &#39;min&#39;: array([0.66388889]),
   &#39;max&#39;: array([0.98888889])}])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> toolbox.evaluate({&#39;C&#39;: 50.614816132626, &#39;kernel&#39;: &#39;rbf&#39;, &#39;gamma&#39;: 700})
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 488 ms, sys: 1.96 ms, total: 490 ms
Wall time: 488 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0.08055555555555556]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

