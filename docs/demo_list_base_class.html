---

title: Using list as base class


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/examples/demo_list_base_class.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/examples/demo_list_base_class.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">creator</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">deap</span> <span class="kn">import</span> <span class="n">algorithms</span>
<span class="kn">from</span> <span class="nn">eptune.parameter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">eptune.algorithms</span> <span class="kn">import</span> <span class="n">eaSimpleWithExtraLog</span>
<span class="kn">from</span> <span class="nn">eptune.sample_cases</span> <span class="kn">import</span> <span class="n">svc_digits</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">toolbox</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Toolbox</span><span class="p">()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LogFloatParameter</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span>
    <span class="n">CategoricalParameter</span><span class="p">([</span><span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">],</span> <span class="s2">&quot;kernel&quot;</span><span class="p">),</span>
    <span class="n">LogFloatParameter</span><span class="p">([</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">],</span> <span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">_params_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">initParams</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">svc_digits</span><span class="o">.</span><span class="n">val_loss_with_params</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">,</span> <span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="n">p</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_params_name</span><span class="p">,</span> <span class="n">params</span><span class="p">)})</span>

<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Fitness</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">))</span>
<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Parameters&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="n">creator</span><span class="o">.</span><span class="n">Loss</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">,</span> <span class="n">initParams</span><span class="p">,</span> <span class="n">creator</span><span class="o">.</span><span class="n">Parameters</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initRepeat</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">individual</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;evaluate&#39;</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">eptune.utils</span> <span class="kn">import</span> <span class="n">ConcurrentMap</span>
<span class="n">pmap</span> <span class="o">=</span> <span class="n">ConcurrentMap</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="n">pmap</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>

<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">selTournament</span><span class="p">,</span> <span class="n">tournsize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mate&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">cxUniform</span><span class="p">,</span> <span class="n">indpb</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">eptune.mutation</span> <span class="kn">import</span> <span class="n">mutRand</span>
<span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mutate&quot;</span><span class="p">,</span> <span class="n">mutRand</span><span class="p">,</span> <span class="n">indpb</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Statistics</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ind</span><span class="p">:</span> <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hof</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">HallOfFame</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">eaSimpleWithExtraLog</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
                                <span class="n">toolbox</span><span class="p">,</span>
                                <span class="n">cxpb</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                                <span class="n">mutpb</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                                <span class="n">ngen</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                <span class="n">halloffame</span><span class="o">=</span><span class="n">hof</span><span class="p">,</span>
                                <span class="n">elitism</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> population, logbook = run()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>gen	nevals	avg          	std         	min          	max          
0  	10    	[-0.44222222]	[0.44635146]	[-0.98888889]	[-0.07777778]
1  	4     	[-0.89777778]	[0.27333333]	[-0.98888889]	[-0.07777778]
2  	8     	[-0.80666667]	[0.36444444]	[-0.98888889]	[-0.07777778]
3  	7     	[-0.80666667]	[0.36444444]	[-0.98888889]	[-0.07777778]
4  	6     	[-0.80611111]	[0.36417037]	[-0.98888889]	[-0.07777778]
5  	7     	[-0.80722222]	[0.36472592]	[-0.99444444]	[-0.07777778]
6  	5     	[-0.625]     	[0.44680795]	[-0.99444444]	[-0.07777778]
7  	7     	[-0.9525]    	[0.11010972]	[-0.99444444]	[-0.62222222]
8  	5     	[-0.75555556]	[0.37224917]	[-0.99444444]	[-0.07777778]
9  	7     	[-0.80777778]	[0.36500423]	[-0.99444444]	[-0.07777778]
10 	6     	[-0.71583333]	[0.41771913]	[-0.99444444]	[-0.07777778]
CPU times: user 102 ms, sys: 56.3 ms, total: 158 ms
Wall time: 5.28 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hof</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[([13.11477071990649, &#39;rbf&#39;, 0.0006438465421550042], [0.9944444444444445]),
 ([62.33679720619008, &#39;rbf&#39;, 0.0003749502086875152], [0.9944444444444445])]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is also possible to print the individual as dictionary.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[({</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">i</span><span class="p">)},</span><span class="n">i</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hof</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[({&#39;C&#39;: 13.11477071990649, &#39;kernel&#39;: &#39;rbf&#39;, &#39;gamma&#39;: 0.0006438465421550042},
  [0.9944444444444445]),
 ({&#39;C&#39;: 62.33679720619008, &#39;kernel&#39;: &#39;rbf&#39;, &#39;gamma&#39;: 0.0003749502086875152},
  [0.9944444444444445])]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

